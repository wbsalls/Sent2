getwd()
?read.files
?list.files
target <- list.files.("D:/s2imgs_old/target")
target <- list.files("D:/s2imgs_old/target")
target <- list.files("D:/s2imgs_old/target")
mci_resampled_50 <- list.files("D:/s2imgs_old/MCI_resampled_50")
sum(target == mci_resampled_50)
sum(target != mci_resampled_50)
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
mu_mci_raw <- read.csv("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
val_df <- data.frame(mu_mci_raw$chla_corr, mu_mci_raw$MCI_L1C)
sum(duplicated(val_df))
val_df_dups <- val_df[duplicated(val_df), ]
mu_mci_orig <- mu_mci_raw[!duplicated(val_df), ]
## subset
# remove land-adjacent
mu_mci <- mu_mci_orig[mu_mci_orig$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
# chl-a vs chl-a
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
l1c_chla <- calc_error_metrics(mu_mci$chla_corr, mu_mci$chla_s2)
l1c_chla
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- 3-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)"),
equal_axes = TRUE,
log_axes = "xy",
states = mu_mci$state,
lakes = mu_mci$comid)
plot(mu_mci$chla_corr, mu_mci$MCI_L1C, col = topo.colors(n = 11, alpha = 0.5), pch = 16, xlim = c(0, 210))
legend(195, 0.04, levels(mu_mci$offset_days_factor), col = topo.colors(11, alpha = 0.5), pch = 16)
legend(195, 0.04, levels(mu_mci$offset_days_factor), col = topo.colors(11, alpha = 0.5), pch = 16)
mu_mci$offset_days_factor <- as.factor(mu_mci$offset_days)
length(levels(mu_mci$offset_days_factor))
#plot(mu_mci$chla_corr, mu_mci$MCI_L1C, col = rainbow(mu_mci$offset_days_factor))
#legend(10, 0.03, levels(mu_mci$offset_days_factor), col = rainbow(1:length(mu_mci$offset_days_factor)), pch=1)
plot(mu_mci$chla_corr, mu_mci$MCI_L1C, col = topo.colors(n = 11, alpha = 0.5), pch = 16, xlim = c(0, 210))
legend(195, 0.04, levels(mu_mci$offset_days_factor), col = topo.colors(11, alpha = 0.5), pch = 16)
l1c <- calc_error_metrics(mu_mci$chla_corr, mu_mci$MCI_L1C)
l1c
# make spdf of matchups
lon <- mu_mci$LongitudeMeasure # **
lat <- mu_mci$LatitudeMeasure # **
mu_mci_pts <- SpatialPointsDataFrame(coords = matrix(c(lon, lat), ncol = 2),
mu_mci, proj4string = CRS("+init=epsg:4326"))
# append state name to each point
us <- readOGR("O:/PRIV/NERL_ORD_CYAN/Salls_working/geospatial_general/US", "cb_2015_us_state_20m")
mu_mci_pts_proj <- spTransform(mu_mci_pts, crs(us))
conus <- us[-which(us$STUSPS %in% c("AK", "HI", "PR")), ]
library(scales)
plot(conus, col = "cornsilk", border = "grey")
plot(mu_mci_pts_proj, pch = 20, col = alpha("black", 0.2), add=TRUE)
library(sp)
mu_mci_pts <- SpatialPointsDataFrame(coords = matrix(c(lon, lat), ncol = 2),
mu_mci, proj4string = CRS("+init=epsg:4326"))
# append state name to each point
us <- readOGR("O:/PRIV/NERL_ORD_CYAN/Salls_working/geospatial_general/US", "cb_2015_us_state_20m")
library(rgdal)
# append state name to each point
us <- readOGR("O:/PRIV/NERL_ORD_CYAN/Salls_working/geospatial_general/US", "cb_2015_us_state_20m")
mu_mci_pts_proj <- spTransform(mu_mci_pts, crs(us))
library(raster)
mu_mci_pts_proj <- spTransform(mu_mci_pts, crs(us))
conus <- us[-which(us$STUSPS %in% c("AK", "HI", "PR")), ]
library(scales)
plot(conus, col = "cornsilk", border = "grey")
plot(mu_mci_pts_proj, pch = 20, col = alpha("black", 0.2), add=TRUE)
?plot
?alpha
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
# chl-a vs chl-a
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
l1c_chla <- calc_error_metrics(mu_mci$chla_corr, mu_mci$chla_s2)
l1c_chla
?lm
?lmodel2
lm2 <- (mu_mci$chla_corr ~ mu_mci$chla_s2)
lm2
lm2 <- lmodel2(mu_mci$chla_corr ~ mu_mci$chla_s2)
lm2
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- 3-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)"),
equal_axes = TRUE,
log_axes = "",
states = mu_mci$state,
lakes = mu_mci$comid)
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- 3-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)"),
equal_axes = TRUE,
log_axes = "xy",
states = mu_mci$state,
lakes = mu_mci$comid)
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
# chl-a vs chl-a
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
l1c_chla <- calc_error_metrics(mu_mci$chla_corr, mu_mci$chla_s2)
l1c_chla
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- 3-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)"),
equal_axes = TRUE,
log_axes = "xy",
states = mu_mci$state,
lakes = mu_mci$comid)
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- 10-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)"),
equal_axes = TRUE,
log_axes = "xy",
states = mu_mci$state,
lakes = mu_mci$comid)
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
mu_mci <- mu_mci[mu_mci$offset_days <= 3, ]
# chl-a vs chl-a
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
l1c_chla <- calc_error_metrics(mu_mci$chla_corr, mu_mci$chla_s2)
l1c_chla
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- 10-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)"),
equal_axes = TRUE,
log_axes = "xy",
states = mu_mci$state,
lakes = mu_mci$comid)
table(mu_mci$offset_days)
mu_mci <- mu_mci_orig[mu_mci_orig$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
table(mu_mci$offset_days)
# subset by offset time
offset_threshold <- 3
mu_mci <- mu_mci[mu_mci$offset_days <= offset_threshold, ]
mu_mci <- mu_mci_orig[mu_mci_orig$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
# subset by offset time
offset_threshold <- 3
mu_mci <- mu_mci[mu_mci$offset_days <= offset_threshold, ]
mu_mci <- mu_mci[mu_mci$offset_days <= 3, ]
mu_mci <- mu_mci_orig[mu_mci_orig$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
# subset by offset time
offset_threshold <- 3
mu_mci <- mu_mci[mu_mci$offset_days <= 3, ]
plot(1,1)
# subset by offset time
offset_threshold <- 3
mu_mci <- mu_mci[mu_mci$offset_days <= offset_threshold, ]
## subset
# remove land-adjacent
mu_mci <- mu_mci_orig[mu_mci_orig$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
# subset by offset time
offset_threshold <- 3
mu_mci <- mu_mci[mu_mci$offset_days <= offset_threshold, ]
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
# chl-a vs chl-a
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
l1c_chla <- calc_error_metrics(mu_mci$chla_corr, mu_mci$chla_s2)
l1c_chla
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- %s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_threshold),
equal_axes = TRUE,
log_axes = "xy",
states = mu_mci$state,
lakes = mu_mci$comid)
x=2
paste0(1, 2, 3, if(x==2){4}, 5)
paste0(1, 2, 3, if(x==3){4}, 5)
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
_
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- %s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_threshold),
equal_axes = TRUE,
log_axes = "xy",
rsq = TRUE,
states = mu_mci$state,
lakes = mu_mci$comid)
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- %s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_threshold),
equal_axes = TRUE,
log_axes = "xy",
rsq = TRUE,
states = mu_mci$state,
lakes = mu_mci$comid)
# remove land-adjacent
mu_mci <- mu_mci_orig[mu_mci_orig$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
# subset by offset time
offset_threshold <- 3
mu_mci <- mu_mci[mu_mci$offset_days <= offset_threshold, ]
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
# chl-a vs chl-a
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
l1c_chla <- calc_error_metrics(mu_mci$chla_corr, mu_mci$chla_s2)
l1c_chla
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- %s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_threshold),
equal_axes = TRUE,
log_axes = "xy",
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid)
## subset
# remove land-adjacent
mu_mci <- mu_mci_orig[mu_mci_orig$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
# subset by offset time
offset_threshold <- 10
mu_mci <- mu_mci[mu_mci$offset_days <= offset_threshold, ]
## plot
# mci vs chl-a
'
l1c <- calc_error_metrics(mu_mci$chla_corr, mu_mci$MCI_L1C)
l1c
#plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$MCI_L1C,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2 MCI (L1C)",
title = sprintf("L1C MCI (r-sq = %s)", round(l1c$r.sq, 2)),
equal_axes = FALSE,
log_axes = "",
states = mu_mci$state,
lakes = mu_mci$comid)
# convert MCI to chlorophyll-a
slope.mci <- l1c$slope # 0.0001579346 from 237 imgs; 0.000222 from 50 imgs
intercept.mci <- l1c$int # -0.0003651727 from 237 imgs; -0.00357 from 50 imgs
slope.mci <- 0.0002 # from Binding et al. 2013 - Ontario
intercept.mci <- -0.0012 # from Binding et al. 2013 - Ontario
'
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
# chl-a vs chl-a
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
l1c_chla <- calc_error_metrics(mu_mci$chla_corr, mu_mci$chla_s2)
l1c_chla
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- %s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_threshold),
equal_axes = TRUE,
log_axes = "xy",
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid)
## subset
# remove land-adjacent
mu_mci <- mu_mci_orig[mu_mci_orig$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
# subset by offset time
offset_threshold <- 0
mu_mci <- mu_mci[mu_mci$offset_days <= offset_threshold, ]
## plot
# mci vs chl-a
'
l1c <- calc_error_metrics(mu_mci$chla_corr, mu_mci$MCI_L1C)
l1c
#plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$MCI_L1C,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2 MCI (L1C)",
title = sprintf("L1C MCI (r-sq = %s)", round(l1c$r.sq, 2)),
equal_axes = FALSE,
log_axes = "",
states = mu_mci$state,
lakes = mu_mci$comid)
# convert MCI to chlorophyll-a
slope.mci <- l1c$slope # 0.0001579346 from 237 imgs; 0.000222 from 50 imgs
intercept.mci <- l1c$int # -0.0003651727 from 237 imgs; -0.00357 from 50 imgs
slope.mci <- 0.0002 # from Binding et al. 2013 - Ontario
intercept.mci <- -0.0012 # from Binding et al. 2013 - Ontario
'
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
# chl-a vs chl-a
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
l1c_chla <- calc_error_metrics(mu_mci$chla_corr, mu_mci$chla_s2)
l1c_chla
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- %s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_threshold),
equal_axes = TRUE,
log_axes = "xy",
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid)
## subset
# remove land-adjacent
mu_mci <- mu_mci_orig[mu_mci_orig$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
# subset by offset time
offset_threshold <- 0
mu_mci <- mu_mci[mu_mci$offset_days <= offset_threshold, ]
## plot
# mci vs chl-a
'
l1c <- calc_error_metrics(mu_mci$chla_corr, mu_mci$MCI_L1C)
l1c
#plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$MCI_L1C,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2 MCI (L1C)",
title = sprintf("L1C MCI (r-sq = %s)", round(l1c$r.sq, 2)),
equal_axes = FALSE,
log_axes = "",
states = mu_mci$state,
lakes = mu_mci$comid)
# convert MCI to chlorophyll-a
slope.mci <- l1c$slope # 0.0001579346 from 237 imgs; 0.000222 from 50 imgs
intercept.mci <- l1c$int # -0.0003651727 from 237 imgs; -0.00357 from 50 imgs
slope.mci <- 0.0002 # from Binding et al. 2013 - Ontario
intercept.mci <- -0.0012 # from Binding et al. 2013 - Ontario
'
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
# chl-a vs chl-a
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
l1c_chla <- calc_error_metrics(mu_mci$chla_corr, mu_mci$chla_s2)
l1c_chla
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- %s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_threshold),
equal_axes = TRUE,
log_axes = "",
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid)
