source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- %s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_threshold),
equal_axes = TRUE,
log_axes = "xy",
plot_abline = FALSE,
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid,
col = col_plot, pch = pch_plot) # col = alpha("black", 0.3), pch = 20
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- %s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_threshold),
equal_axes = TRUE,
log_axes = "xy",
plot_abline = FALSE,
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid,
col = col_plot, pch = pch_plot) # col = alpha("black", 0.3), pch = 20
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2,
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
title = sprintf("+/- %s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_threshold),
equal_axes = TRUE,
log_axes = "xy",
plot_abline = FALSE,
rsq = TRUE,
states = mu_mci$state,
lakes = mu_mci$comid,
col = col_plot, pch = pch_plot) # col = alpha("black", 0.3), pch = 20
library(colorRamps)
library(grDevices)
library(RColorBrewer)
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
#source("/Users/wilsonsalls/Desktop/EPA/Sentinel2/Validation/error_metrics_1800403.R")
#mu_mci_raw <- mu_mci
mu_mci_raw <- read.csv("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
#mu_mci_raw <- read.csv("/Users/wilsonsalls/Desktop/EPA/Sentinel2/Validation/validation_S2_117imgs_MCI_L1C_2018-04-05.csv", stringsAsFactors = FALSE)
# remove duplicates: identify based on duplicated chlorophyll-a and MCI (L1C)
val_df <- data.frame(mu_mci_raw$chla_corr, mu_mci_raw$MCI_L1C, mu_mci_raw$LatitudeMeasure, mu_mci_raw$LongitudeMeasure)
sum(duplicated(val_df))
val_df_dups <- val_df[duplicated(val_df), ]
mu_mci_orig <- mu_mci_raw[!duplicated(val_df), ]
# most duplicates have 0 MCI_L1C
#
## subset
# remove land-adjacent
mu_mci <- mu_mci_orig[mu_mci_orig$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
# for plotting color
mu_mci$offset_days_factor <- as.factor(mu_mci$offset_days)
length(levels(mu_mci$offset_days_factor))
jcolors <- data.frame(day = levels(mu_mci$offset_days_factor),
color = I(topo.colors(11, alpha = 0.5)))
getwd()
write.csv(mu_mci, sprintf("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_Chla_%s.csv", Sys.Date()))
#mu_mci_raw <- mu_mci
#mu_mci_raw <- read.csv("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
mu_mci_raw <- read.csv("/Users/wilsonsalls/Desktop/EPA/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
#mu_mci_raw <- mu_mci
mu_mci_raw <- read.csv("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
min(mu_mci_raw$dist_shore_m)
library(chron)
library(colorRamps)
library(grDevices)
library(RColorBrewer)
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
#source("/Users/wilsonsalls/Desktop/Git/Sent2/error_metrics_1800611.R")
#mu_mci_raw <- mu_mci
mu_mci_raw <- read.csv("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
#mu_mci_raw <- read.csv("/Users/wilsonsalls/Desktop/EPA/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
length(unique(mu_mci_raw$system.index))
length(levels(mu_mci$offset_days_factor))
jcolors <- data.frame(day = levels(mu_mci$offset_days_factor),
color = I(topo.colors(11, alpha = 0.5)))
#
## calc chl a from MCI  ---------------
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
mu_mci$residual_chla <- abs(mu_mci$chla_s2 - mu_mci$chla_corr) # residual
mu_mci$pct_error_chla <- (abs(mu_mci$chla_s2 - mu_mci$chla_corr) / mu_mci$chla_corr) * 100 # % error
## subset ---------------
# remove land-adjacent
#mu_mci <- mu_mci[mu_mci$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
# export final validation data set
#write.csv(mu_mci, sprintf("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_Chla_%s.csv", Sys.Date()))
mu_mci_preoffset <- mu_mci
source("C:/Users/WSalls/Desktop/Git/Sent2/error_metrics_1800611.R")
#mu_mci_raw <- mu_mci
mu_mci_raw <- read.csv("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
#mu_mci_raw <- read.csv("/Users/wilsonsalls/Desktop/EPA/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
# remove duplicates: identify based on duplicated chlorophyll-a and MCI (L1C)
val_df <- data.frame(mu_mci_raw$chla_corr, mu_mci_raw$MCI_L1C, mu_mci_raw$LatitudeMeasure, mu_mci_raw$LongitudeMeasure)
sum(duplicated(val_df))
val_df_dups <- val_df[duplicated(val_df), ]
mu_mci <- mu_mci_raw[!duplicated(val_df), ]
# most duplicates have 0 MCI_L1C
#* fix chron
mu_mci$samp_localTime <- chron(dates. = substr(mu_mci$samp_localTime, 2, 9),
times. = substr(mu_mci$samp_localTime, 11, 18))
mu_mci$img_localTime <- chron(dates. = substr(mu_mci$img_localTime, 2, 9),
times. = substr(mu_mci$img_localTime, 11, 18))
mu_mci$offset_hrs <- as.numeric(mu_mci$samp_localTime - mu_mci$img_localTime) * 24
# for plotting color
mu_mci$offset_days_factor <- as.factor(mu_mci$offset_days)
length(levels(mu_mci$offset_days_factor))
jcolors <- data.frame(day = levels(mu_mci$offset_days_factor),
color = I(topo.colors(11, alpha = 0.5)))
#
## calc chl a from MCI  ---------------
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
mu_mci$residual_chla <- abs(mu_mci$chla_s2 - mu_mci$chla_corr) # residual
mu_mci$pct_error_chla <- (abs(mu_mci$chla_s2 - mu_mci$chla_corr) / mu_mci$chla_corr) * 100 # % error
## subset ---------------
# remove land-adjacent
#mu_mci <- mu_mci[mu_mci$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
# export final validation data set
#write.csv(mu_mci, sprintf("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_Chla_%s.csv", Sys.Date()))
mu_mci_preoffset <- mu_mci
# subset by offset time
mu_mci <- mu_mci_preoffset
offset_min <- 0
offset_max <- 10
offset_threshold <- offset_min:offset_max
mu_mci <- mu_mci[mu_mci$offset_days %in% offset_threshold, ]
col_plot <- alpha("black", 0.3)
pch_plot <- 20
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2, # export 800 x 860
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
#title = sprintf("+/- %sday", offset_min),
title = sprintf("+/- %s-%s days", offset_min, offset_max),
#title = sprintf("+/- %s-%s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_min, offset_max),
equal_axes = TRUE,
log_axes = "xy",
plot_abline = FALSE,
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid,
col = col_plot, pch = pch_plot,
xlim = c(0.05, 200),
ylim = c(0.05, 200),
xaxt="n",
yaxt="n") # col = alpha("black", 0.3), pch = 20
axis(1, at = c(10^(-1:3)), labels = c(10^(-1:3)))
axis(2, at = c(10^(-1:3)), labels = c(10^(-1:3)))
boxplot(residual_chla ~ ResultAnalyticalMethod.MethodIdentifierContext, data = mu_mci,
ylab = "chl a residual",
xlab = "Method Identifier Context")
unique(mu_mci$ResultAnalyticalMethod.MethodIdentifierContext)
head(mu_mci)
# subset by method
mu_mci <- mu_mci[mu_mci$ResultAnalyticalMethod.MethodIdentifierContext == "USEPA", ]
# b & w
col_plot <- alpha("black", 0.3)
pch_plot <- 20
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2, # export 800 x 860
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
#title = sprintf("+/- %sday", offset_min),
title = sprintf("+/- %s-%s days", offset_min, offset_max),
#title = sprintf("+/- %s-%s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_min, offset_max),
equal_axes = TRUE,
log_axes = "xy",
plot_abline = FALSE,
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid,
col = col_plot, pch = pch_plot,
xlim = c(0.05, 200),
ylim = c(0.05, 200),
xaxt="n",
yaxt="n") # col = alpha("black", 0.3), pch = 20
axis(1, at = c(10^(-1:3)), labels = c(10^(-1:3)))
axis(2, at = c(10^(-1:3)), labels = c(10^(-1:3)))
mu_mci_preoffset <- mu_mci
# subset by offset time
mu_mci <- mu_mci_preoffset
#mu_mci_raw <- mu_mci
mu_mci_raw <- read.csv("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
#mu_mci_raw <- read.csv("/Users/wilsonsalls/Desktop/EPA/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
# remove duplicates: identify based on duplicated chlorophyll-a and MCI (L1C)
val_df <- data.frame(mu_mci_raw$chla_corr, mu_mci_raw$MCI_L1C, mu_mci_raw$LatitudeMeasure, mu_mci_raw$LongitudeMeasure)
sum(duplicated(val_df))
val_df_dups <- val_df[duplicated(val_df), ]
mu_mci <- mu_mci_raw[!duplicated(val_df), ]
# most duplicates have 0 MCI_L1C
#* fix chron
mu_mci$samp_localTime <- chron(dates. = substr(mu_mci$samp_localTime, 2, 9),
times. = substr(mu_mci$samp_localTime, 11, 18))
mu_mci$img_localTime <- chron(dates. = substr(mu_mci$img_localTime, 2, 9),
times. = substr(mu_mci$img_localTime, 11, 18))
mu_mci$offset_hrs <- as.numeric(mu_mci$samp_localTime - mu_mci$img_localTime) * 24
# for plotting color
mu_mci$offset_days_factor <- as.factor(mu_mci$offset_days)
length(levels(mu_mci$offset_days_factor))
jcolors <- data.frame(day = levels(mu_mci$offset_days_factor),
color = I(topo.colors(11, alpha = 0.5)))
#
## calc chl a from MCI  ---------------
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
mu_mci$residual_chla <- abs(mu_mci$chla_s2 - mu_mci$chla_corr) # residual
mu_mci$pct_error_chla <- (abs(mu_mci$chla_s2 - mu_mci$chla_corr) / mu_mci$chla_corr) * 100 # % error
## subset ---------------
# remove land-adjacent
#mu_mci <- mu_mci[mu_mci$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
# subset by offset time
mu_mci <- mu_mci_preoffset
offset_min <- 0
offset_max <- 3
offset_threshold <- offset_min:offset_max
mu_mci <- mu_mci[mu_mci$offset_days %in% offset_threshold, ]
#mu_mci_raw <- mu_mci
mu_mci_raw <- read.csv("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
#mu_mci_raw <- read.csv("/Users/wilsonsalls/Desktop/EPA/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
# remove duplicates: identify based on duplicated chlorophyll-a and MCI (L1C)
val_df <- data.frame(mu_mci_raw$chla_corr, mu_mci_raw$MCI_L1C, mu_mci_raw$LatitudeMeasure, mu_mci_raw$LongitudeMeasure)
sum(duplicated(val_df))
val_df_dups <- val_df[duplicated(val_df), ]
mu_mci <- mu_mci_raw[!duplicated(val_df), ]
# most duplicates have 0 MCI_L1C
#* fix chron
mu_mci$samp_localTime <- chron(dates. = substr(mu_mci$samp_localTime, 2, 9),
times. = substr(mu_mci$samp_localTime, 11, 18))
mu_mci$img_localTime <- chron(dates. = substr(mu_mci$img_localTime, 2, 9),
times. = substr(mu_mci$img_localTime, 11, 18))
mu_mci$offset_hrs <- as.numeric(mu_mci$samp_localTime - mu_mci$img_localTime) * 24
# for plotting color
mu_mci$offset_days_factor <- as.factor(mu_mci$offset_days)
length(levels(mu_mci$offset_days_factor))
jcolors <- data.frame(day = levels(mu_mci$offset_days_factor),
color = I(topo.colors(11, alpha = 0.5)))
#
## calc chl a from MCI  ---------------
slope.mci <- 0.0004 # from Binding et al. 2013 - Erie
intercept.mci <- -0.0021 # from Binding et al. 2013 - Erie
mu_mci$chla_s2 <- (mu_mci$MCI_L1C - intercept.mci) / slope.mci
mu_mci <- mu_mci[mu_mci$chla_s2 > 0, ] # remove calculated negatives -617 (depends on coefficients used)
mu_mci$residual_chla <- abs(mu_mci$chla_s2 - mu_mci$chla_corr) # residual
mu_mci$pct_error_chla <- (abs(mu_mci$chla_s2 - mu_mci$chla_corr) / mu_mci$chla_corr) * 100 # % error
## subset ---------------
# remove land-adjacent
#mu_mci <- mu_mci[mu_mci$dist_shore_m >= 30, ]
# remove NAs
sum(is.na(mu_mci$MCI_L1C))
mu_mci <- mu_mci[!is.na(mu_mci$MCI_L1C), ]
# remove 0s (NA MCI_L1C)
sum(mu_mci$MCI_L1C == 0)
mu_mci <- mu_mci[mu_mci$MCI_L1C != 0, ]
# remove outliers
max(mu_mci$MCI_L1C)
mu_mci <- mu_mci[mu_mci$MCI_L1C != max(mu_mci$MCI_L1C), ]
min(mu_mci$MCI_L1C)
sum(mu_mci$MCI_L1C < -0.01)
mu_mci <- mu_mci[mu_mci$MCI_L1C > -0.01, ]
sum(mu_mci$chla_corr > 200)
mu_mci <- mu_mci[mu_mci$chla_corr < 200, ]
mu_mci_preoffset <- mu_mci
# subset by offset time
mu_mci <- mu_mci_preoffset
offset_min <- 0
offset_max <- 3
offset_threshold <- offset_min:offset_max
mu_mci <- mu_mci[mu_mci$offset_days %in% offset_threshold, ]
# subset by method
mu_mci <- mu_mci[mu_mci$ResultAnalyticalMethod.MethodIdentifierContext == "APHA", ]
# b & w
col_plot <- alpha("black", 0.3)
pch_plot <- 20
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2, # export 800 x 860
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
#title = sprintf("+/- %sday", offset_min),
title = sprintf("+/- %s-%s days", offset_min, offset_max),
#title = sprintf("+/- %s-%s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_min, offset_max),
equal_axes = TRUE,
log_axes = "xy",
plot_abline = FALSE,
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid,
col = col_plot, pch = pch_plot,
xlim = c(0.05, 200),
ylim = c(0.05, 200),
xaxt="n",
yaxt="n") # col = alpha("black", 0.3), pch = 20
axis(1, at = c(10^(-1:3)), labels = c(10^(-1:3)))
axis(2, at = c(10^(-1:3)), labels = c(10^(-1:3)))
mu_mci <- mu_mci_preoffset
offset_min <- 0
offset_max <- 3
offset_threshold <- offset_min:offset_max
mu_mci <- mu_mci[mu_mci$offset_days %in% offset_threshold, ]
# b & w
col_plot <- alpha("black", 0.3)
pch_plot <- 20
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2, # export 800 x 860
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
#title = sprintf("+/- %sday", offset_min),
title = sprintf("+/- %s-%s days", offset_min, offset_max),
#title = sprintf("+/- %s-%s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_min, offset_max),
equal_axes = TRUE,
log_axes = "xy",
plot_abline = FALSE,
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid,
col = col_plot, pch = pch_plot,
xlim = c(0.05, 200),
ylim = c(0.05, 200),
xaxt="n",
yaxt="n") # col = alpha("black", 0.3), pch = 20
axis(1, at = c(10^(-1:3)), labels = c(10^(-1:3)))
axis(2, at = c(10^(-1:3)), labels = c(10^(-1:3)))
unique(mu_mci$ResultAnalyticalMethod.MethodIdentifierContext)
# subset by offset time
mu_mci <- mu_mci_preoffset
offset_min <- 0
offset_max <- 3
offset_threshold <- offset_min:offset_max
mu_mci <- mu_mci[mu_mci$offset_days %in% offset_threshold, ]
# subset by method
mu_mci <- mu_mci[which(mu_mci$ResultAnalyticalMethod.MethodIdentifierContext == "USGS"), ]
### plot  ---------------
# b & w
col_plot <- alpha("black", 0.3)
pch_plot <- 20
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2, # export 800 x 860
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
#title = sprintf("+/- %sday", offset_min),
title = sprintf("+/- %s-%s days", offset_min, offset_max),
#title = sprintf("+/- %s-%s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_min, offset_max),
equal_axes = TRUE,
log_axes = "xy",
plot_abline = FALSE,
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid,
col = col_plot, pch = pch_plot,
xlim = c(0.05, 200),
ylim = c(0.05, 200),
xaxt="n",
yaxt="n") # col = alpha("black", 0.3), pch = 20
axis(1, at = c(10^(-1:3)), labels = c(10^(-1:3)))
axis(2, at = c(10^(-1:3)), labels = c(10^(-1:3)))
unique(mu_mci$ResultAnalyticalMethod.MethodIdentifierContext)
# subset by offset time
mu_mci <- mu_mci_preoffset
offset_min <- 0
offset_max <- 3
offset_threshold <- offset_min:offset_max
mu_mci <- mu_mci[mu_mci$offset_days %in% offset_threshold, ]
# subset by method
mu_mci <- mu_mci[which(mu_mci$ResultAnalyticalMethod.MethodIdentifierContext == "APHA"), ]
### plot  ---------------
# b & w
col_plot <- alpha("black", 0.3)
pch_plot <- 20
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2, # export 800 x 860
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
#title = sprintf("+/- %sday", offset_min),
title = sprintf("+/- %s-%s days", offset_min, offset_max),
#title = sprintf("+/- %s-%s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_min, offset_max),
equal_axes = TRUE,
log_axes = "xy",
plot_abline = FALSE,
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid,
col = col_plot, pch = pch_plot,
xlim = c(0.05, 200),
ylim = c(0.05, 200),
xaxt="n",
yaxt="n") # col = alpha("black", 0.3), pch = 20
axis(1, at = c(10^(-1:3)), labels = c(10^(-1:3)))
axis(2, at = c(10^(-1:3)), labels = c(10^(-1:3)))
# subset by offset time
mu_mci <- mu_mci_preoffset
offset_min <- 0
offset_max <- 10
offset_threshold <- offset_min:offset_max
mu_mci <- mu_mci[mu_mci$offset_days %in% offset_threshold, ]
# subset by method
mu_mci <- mu_mci[which(mu_mci$ResultAnalyticalMethod.MethodIdentifierContext == "USEPA"), ]
### plot  ---------------
# b & w
col_plot <- alpha("black", 0.3)
pch_plot <- 20
plot_error_metrics(x = mu_mci$chla_corr, y = mu_mci$chla_s2, # export 800 x 860
xname = "in situ chlorophyll-a (ug/l)",
yname = "S2-derived chlorophyll-a (from MCI L1C)",
#title = sprintf("+/- %sday", offset_min),
title = sprintf("+/- %s-%s days", offset_min, offset_max),
#title = sprintf("+/- %s-%s-day validation of Sentinel-2-derived chlorophyll-a\n(coefficients from Binding et al. [2013], Lake Erie)", offset_min, offset_max),
equal_axes = TRUE,
log_axes = "xy",
plot_abline = FALSE,
rsq = FALSE,
states = mu_mci$state,
lakes = mu_mci$comid,
col = col_plot, pch = pch_plot,
xlim = c(0.05, 200),
ylim = c(0.05, 200),
xaxt="n",
yaxt="n") # col = alpha("black", 0.3), pch = 20
axis(1, at = c(10^(-1:3)), labels = c(10^(-1:3)))
axis(2, at = c(10^(-1:3)), labels = c(10^(-1:3)))
length(unique(mu_mci$PRODUCT_ID))
# subset by offset time
mu_mci <- mu_mci_preoffset
length(unique(mu_mci$PRODUCT_ID))
length(unique(mu_mci$system.index))
length(unique(mu_mci_raw$system.index))
#mu_mci_raw <- mu_mci
mu_mci_raw <- read.csv("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
# remove duplicates: identify based on duplicated chlorophyll-a and MCI (L1C)
val_df <- data.frame(mu_mci_raw$chla_corr, mu_mci_raw$MCI_L1C, mu_mci_raw$LatitudeMeasure, mu_mci_raw$LongitudeMeasure)
sum(duplicated(val_df))
val_df_dups <- val_df[duplicated(val_df), ]
mu_mci <- mu_mci_raw[!duplicated(val_df), ]
#mu_mci_raw <- mu_mci
mu_mci_raw <- read.csv("O:/PRIV/NERL_ORD_CYAN/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
#mu_mci_raw <- read.csv("/Users/wilsonsalls/Desktop/EPA/Sentinel2/Validation/682_imgs/validation_S2_682imgs_MCI_L1C_2018-08-24.csv", stringsAsFactors = FALSE)
# remove duplicates: identify based on duplicated chlorophyll-a and MCI (L1C)
val_df <- data.frame(mu_mci_raw$chla_corr, mu_mci_raw$MCI_L1C, mu_mci_raw$LatitudeMeasure, mu_mci_raw$LongitudeMeasure)
sum(duplicated(val_df))
val_df_dups <- val_df[duplicated(val_df), ]
mu_mci <- mu_mci_raw[!duplicated(val_df), ]
length(unique(mu_mci_raw$system.index))
# subset by offset time
mu_mci <- mu_mci_preoffset
offset_min <- 0
offset_max <- 10
offset_threshold <- offset_min:offset_max
mu_mci <- mu_mci[mu_mci$offset_days %in% offset_threshold, ]
# subset by method
mu_mci <- mu_mci[which(mu_mci$ResultAnalyticalMethod.MethodIdentifierContext == "USEPA"), ]
